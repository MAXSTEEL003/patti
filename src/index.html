<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="description"
    content="Patti Note Calculator ‚Äî instantly calculate, preview, and export patti notes with Firebase sync.">
  <meta name="theme-color" content="#2563eb">
  <title>Patti Calculator</title>
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üóíÔ∏è</text></svg>">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="app">
    <header class="header">
      <h1>Patti Note Calculator</h1>
      <div class="header-actions">
        <button id="go_pattis" class="btn-primary">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24">
            <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z" />
          </svg>
          View Pattis Gallery
        </button>
      </div>
    </header>
    <div class="main-content">
      <div class="right-panel">
        <div class="preview-section">
          <h2>Preview</h2>
          <div class="preview" id="note">
            <table class="sheet" role="grid">
              <colgroup>
                <col style="width:11.1111%">
                <col style="width:11.1111%">
                <col style="width:11.1111%">
                <col style="width:11.1111%">
                <col style="width:11.1111%">
                <col style="width:11.1111%">
                <col style="width:11.1111%">
                <col style="width:11.1111%">
                <col style="width:11.1111%">
              </colgroup>
              <tbody>
                <!-- Row 1 -->
                <tr>
                  <td id="A1">MILLER NAME</td>
                  <td id="B1" colspan="8" class="merged"><span id="B1_value"></span></td>
                </tr>
                <!-- Row 2 -->
                <tr>
                  <td id="A2">PARTY NAME</td>
                  <td id="B2" colspan="8" class="merged">&nbsp;</td>
                </tr>
                <!-- Row 3 -->
                <tr>
                  <td id="A3">BILL NO</td>
                  <td id="B3">&nbsp;</td>
                  <td id="C3">&nbsp;</td>
                  <td id="D3">&nbsp;</td>
                  <td id="E3">&nbsp;</td>
                  <td id="F3">&nbsp;</td>
                  <td id="G3">&nbsp;</td>
                  <td id="H3">&nbsp;</td>
                  <td id="I3">&nbsp;</td>
                </tr>
                <!-- Row 4 -->
                <tr>
                  <td id="A4">ARRIVAL DT</td>
                  <td id="B4">&nbsp;</td>
                  <td id="C4">&nbsp;</td>
                  <td id="D4">&nbsp;</td>
                  <td id="E4" colspan="3" class="merged">&nbsp;</td>
                  <td id="H4">&nbsp;</td>
                  <td id="I4">&nbsp;</td>
                </tr>
                <!-- Row 5 (RATE) -->
                <tr>
                  <td id="A5">RATE</td>
                  <td id="B5">&nbsp;</td>
                  <td id="C5">&nbsp;</td>
                  <td id="D5">&nbsp;</td>
                  <td id="E5" colspan="3" class="merged">&nbsp;</td>
                  <td id="H5">&nbsp;</td>
                  <td id="I5">&nbsp;</td>
                </tr>
                <!-- Row 6 (LORRY HIRE) -->
                <tr>
                  <td id="A6">LORRY HIRE</td>
                  <td id="B6">&nbsp;</td>
                  <td id="C6">&nbsp;</td>
                  <td id="D6">&nbsp;</td>
                  <td id="E6" colspan="3" class="merged"><span id="E6_value"></span><span id="G6">&nbsp;</span></td>
                  <td id="H6">CHQ AM</td>
                  <td id="I6">&nbsp;</td>
                </tr>
                <!-- Row 7 (DISCOUNT) -->
                <tr>
                  <td id="A7">DISCOUNT</td>
                  <td id="B7">&nbsp;</td>
                  <td id="C7">&nbsp;</td>
                  <td id="D7">&nbsp;</td>
                  <td id="E7" colspan="3" class="merged">&nbsp;</td>
                  <td id="H7">CHQ NO</td>
                  <td id="I7">&nbsp;</td>
                </tr>
                <!-- Row 8 (SELLER COM) -->
                <tr>
                  <td id="A8">SELLER COM</td>
                  <td id="B8">&nbsp;</td>
                  <td id="C8">&nbsp;</td>
                  <td id="D8">&nbsp;</td>
                  <td id="E8" colspan="3" class="merged">&nbsp;</td>
                  <td id="H8">CHQ DT</td>
                  <td id="I8">&nbsp;</td>
                </tr>
                <!-- Row 9 (SHORTAGE) -->
                <tr>
                  <td id="A9">SHORTAGE</td>
                  <td id="B9">&nbsp;</td>
                  <td id="C9">&nbsp;</td>
                  <td id="D9">&nbsp;</td>
                  <td id="E9" colspan="3" class="merged">&nbsp;</td>
                  <td id="H9">BANK</td>
                  <td id="I9">&nbsp;</td>
                </tr>
                <!-- Row 10 (Q-DIFF) - merge D10 with row below -->
                <tr>
                  <td id="A10">Q-DIFF</td>
                  <td id="B10">&nbsp;</td>
                  <td id="C10">&nbsp;</td>
                  <td id="D10" rowspan="2" colspan="6" class="merged"><span id="D10_value">&nbsp;</span></td>
                </tr>
                <!-- Row 11 (TOTAL) - D11 merged into D10 above -->
                <tr>
                  <td id="A11">TOTAL</td>
                  <td id="B11">&nbsp;</td>
                  <td id="C11">&nbsp;</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="right-controls">
            <!-- Row 1: Export actions -->
            <div class="btn-group-label">Export</div>
            <div class="control-group">
              <button id="exportBtn" class="btn-action btn-green">
                <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                  <polyline points="7 10 12 15 17 10" />
                  <line x1="12" y1="15" x2="12" y2="3" />
                </svg>
                Export PNG
              </button>
              <button id="downloadPdfBtn" class="btn-action btn-blue">
                <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                  <polyline points="14 2 14 8 20 8" />
                </svg>
                Download PDF
              </button>
            </div>

            <!-- Row 2: Copy / Open -->
            <div class="btn-group-label">Share</div>
            <div class="control-group">
              <button id="copyBtn" class="btn-action btn-cyan">
                <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <rect x="9" y="9" width="13" height="13" rx="2" />
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                </svg>
                Copy Image
              </button>
              <button id="openImageBtn" class="btn-action btn-slate">
                <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <rect x="3" y="3" width="18" height="18" rx="2" />
                  <circle cx="8.5" cy="8.5" r="1.5" />
                  <polyline points="21 15 16 10 5 21" />
                </svg>
                Open Image
              </button>
            </div>

            <!-- Row 3: Save -->
            <div class="btn-group-label">Storage</div>
            <div class="control-group">
              <button id="save_pattis" class="btn-action btn-indigo btn-full" title="Save this note to Pattis">
                <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                  <polyline points="17 21 17 13 7 13 7 21" />
                  <polyline points="7 3 7 8 15 8" />
                </svg>
                Save to Pattis
              </button>
            </div>

            <!-- Row 4: Danger zone -->
            <div class="btn-group-label danger-label">Danger Zone</div>
            <div class="control-group">
              <button id="resetBtn" class="btn-action btn-red btn-full">
                <svg width="15" height="15" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <polyline points="1 4 1 10 7 10" />
                  <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" />
                </svg>
                Reset All Fields
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="left-panel">
        <div class="form-section">
          <h2>Quick Entry</h2>
          <div class="top-fields">
            <div class="field-group">
              <label>QTY</label>
              <input id="rate_qty" type="text">
            </div>
            <div class="field-group">
              <label>RATE</label>
              <input id="rate_rate" type="text">
            </div>
          </div>
        </div>

        <div class="form-section">
          <h2>Details</h2>
          <div class="inputs-grid">
            <div class="field-group">
              <label>MILLER NAME</label>
              <div class="name-input">
                <select id="miller_name" class="name-select">
                  <option value="">Select Miller...</option>
                </select>
                <button type="button" id="add_miller_btn" title="Manage millers">‚öô Manage</button>
              </div>
            </div>
            <div class="field-group">
              <label>PARTY NAME</label>
              <div class="name-input">
                <select id="party_name" class="name-select">
                  <option value="">Select Party...</option>
                </select>
                <button type="button" id="add_party_btn" title="Manage parties">‚öô Manage</button>
              </div>
            </div>

            <div class="field-group">
              <label>BILL NO</label>
              <input id="bill_no">
            </div>
            <div class="field-group">
              <label>ARRIVAL DT</label>
              <input id="arrival_dt" type="date">
            </div>

            <div class="field-group">
              <label>LORRY HIRE</label>
              <input id="lorry_small" type="text">
            </div>
            <div class="field-group">
              <label>SELLER COM</label>
              <input id="seller_commission" type="text">
            </div>

            <div class="field-group">
              <label>DISCOUNT</label>
              <div class="discount-controls">
                <select id="discount_select">
                  <option value="0">No discount</option>
                  <option value="0.04">4%</option>
                  <option value="0.03">3%</option>
                  <option value="0.02">2%</option>
                  <option value="0.01">1%</option>
                </select>
                <span id="date_diff">Days: -</span>
              </div>
            </div>
            <div class="field-group">
              <label>Q-DIFF</label>
              <input id="qdiff" type="text">
            </div>

            <div class="field-group">
              <label>REMARKS</label>
              <input id="remarks" placeholder="e.g. RTGS AM">
            </div>
            <div class="field-group">
              <label>CHQ AM</label>
              <input id="chq_amount" type="text">
            </div>
            <div class="field-group">
              <label>CHQ NO</label>
              <input id="chq_no" type="text">
            </div>
            <div class="field-group">
              <label>CHQ DT</label>
              <input id="chq_date" type="date">
            </div>
            <div class="field-group">
              <label>BANK</label>
              <input id="bank" type="text">
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- Export diagnostic modal -->
  <div id="exportDiagModal" class="modal" aria-hidden="true"
    style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);align-items:center;justify-content:center;z-index:9999;">
    <div class="modal-content"
      style="background:#fff;padding:18px;border-radius:8px;max-width:760px;margin:auto;box-shadow:0 8px 30px rgba(2,6,23,0.4);">
      <h3 style="margin-top:0">Export diagnostic</h3>
      <p id="diagIntro">Scanning the page for likely cross-origin assets that can taint the canvas...</p>
      <ul id="diagList" style="max-height:320px;overflow:auto;padding-left:16px;margin-bottom:12px;"></ul>
      <div class="modal-actions" style="display:flex;gap:8px;justify-content:flex-end;">
        <button id="diagClose" class="btn-secondary">Close</button>
      </div>
    </div>
  </div>
  <!-- High-res preview removed: single Download PDF action provided instead -->
  <!-- Firebase config: provided by user. This sets window.FIREBASE_CONFIG for firebase-init.js -->
  <script>
    window.FIREBASE_CONFIG = {
      apiKey: "AIzaSyCWGo-VjC-4ZPUts6wDCpNjRaD2c-M_dC0",
      authDomain: "patticalculator.firebaseapp.com",
      projectId: "patticalculator",
      storageBucket: "patticalculator.firebasestorage.app",
      messagingSenderId: "590381439239",
      appId: "1:590381439239:web:9f20cd229dd335a894cda2",
      measurementId: "G-M8YETCJ2MS"
    };
  </script>
  <!-- Server rasterizer support removed ‚Äî client-only PNG export is used -->
  <script src="firebase-init.js"></script>
  <script src="app.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>

</html>